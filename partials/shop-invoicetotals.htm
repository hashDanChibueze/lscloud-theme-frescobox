<ul class="price-list list-group">
{% set cartTotalNoTax = 0 %}
{% for shipment in invoice.shipments %}
  {% for item in shipment.shipmentItems %}
    {% set cartTotalNoTax = cartTotalNoTax + item.price %}
  {% endfor %}
{% endfor %}
{% set discount = totals.discount_total %}
{% if cartTotalNoTax > 0 %}
    <li class="list-group-item">Item Total: <div class="pull-right">{{ cartTotalNoTax|currency }}</div></li>
{% endif %}
{% if cartTotalNoTax > 0 %}
    {% for plan in billingPlans %}
        {% if order.subscription.billing_plan_id == plan.id %}
            {% if '%' in plan.setup_fee_or_percentage %}
                {% set fee = plan.setup_fee_or_percentage|trim('%') * cartTotalNoTax / 100 %}
            {% else %}
                {% set fee = plan.setup_fee_or_percentage %}
            {% endif %}
            <li class="list-group-item">Subscription Signup: <div class="pull-right">{{ fee|currency }} </div></li>
            {% set subDiscount = (plan.discount_percentage|trim('%') * (cartTotalNoTax + fee - invoice.total_discount) / 100) %}
            {% set discount = totals.discount_total + subDiscount %}
        {% endif %}    
    {% endfor %}
{% endif %}
{% if invoice.total_shipping_quote > 0 %}
    <li class="list-group-item">Shipping: <div class="pull-right">{{ invoice.total_shipping_quote|currency }}</div></li>
{% endif %}
    {% if invoice.total_tax > 0 %}
<li class="list-group-item">Tax:<div class="pull-right">{{ invoice.total_tax|currency }}</div></li>
{% endif %}
{% if discount > 0 %}
    <li class="list-group-item">Discount: <div class="pull-right cart-discount">- {{ discount|currency }}</div></li>
{% endif %}
<li class="list-group-item important">Total: <div class="pull-right">{{ invoice.total|currency }}</div></li>
</ul>
